"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LibreLinkUpClient = void 0;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _axios = _interopRequireDefault(require("axios"));
var _jsSha = require("js-sha256");
var _utils = require("./utils");
var LIBRE_LINK_SERVER = 'https://api-us.libreview.io';
var urlMap = {
  login: '/llu/auth/login',
  connections: '/llu/connections',
  countries: '/llu/config/country?country=DE'
};
var LibreLinkUpClient = function LibreLinkUpClient(_ref) {
  var username = _ref.username,
    password = _ref.password,
    clientVersion = _ref.clientVersion,
    connectionIdentifier = _ref.connectionIdentifier;
  var jwtToken = null;
  var accountId = null;
  var connectionId = null;
  var instance = _axios["default"].create({
    baseURL: LIBRE_LINK_SERVER,
    headers: {
      'accept-encoding': 'gzip',
      'cache-control': 'no-cache',
      connection: 'Keep-Alive',
      'content-type': 'application/json',
      product: 'llu.android',
      version: clientVersion !== null && clientVersion !== void 0 ? clientVersion : '4.12.0',
      'account-id': ''
    }
  });
  instance.interceptors.request.use(function (config) {
    if (jwtToken && config.headers && accountId) {
      // eslint-disable-next-line no-param-reassign
      config.headers.authorization = "Bearer ".concat(jwtToken);
      // eslint-disable-next-line no-param-reassign
      config.headers['account-id'] = (0, _jsSha.sha256)(accountId);
    }
    return config;
  }, function (e) {
    return e;
  }, {
    synchronous: true
  });
  var login = /*#__PURE__*/function () {
    var _ref2 = (0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee() {
      var loginResponse, _step, redirectResponse, countryNodes, targetRegion, regionDefinition;
      return _regenerator["default"].wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return instance.post(urlMap.login, {
                email: username,
                password: password
              });
            case 2:
              loginResponse = _context.sent;
              if (!(loginResponse.data.status === 2)) {
                _context.next = 5;
                break;
              }
              throw new Error('Bad credentials. Please ensure that you have entered the credentials of your LibreLinkUp account (and not of your LibreLink account).');
            case 5:
              if (!(loginResponse.data.status === 4)) {
                _context.next = 7;
                break;
              }
              throw new Error("Additional action required for your account: ".concat(((_step = loginResponse.data.data.step) === null || _step === void 0 ? void 0 : _step.componentName) || 'unknown', ". Please login via app and perform required steps and try again."));
            case 7:
              if (!loginResponse.data.data.redirect) {
                _context.next = 18;
                break;
              }
              redirectResponse = loginResponse.data;
              _context.next = 11;
              return instance.get(urlMap.countries);
            case 11:
              countryNodes = _context.sent;
              targetRegion = redirectResponse.data.region;
              regionDefinition = countryNodes.data.data.regionalMap[targetRegion];
              if (regionDefinition) {
                _context.next = 16;
                break;
              }
              throw new Error("Unable to find region '".concat(redirectResponse.data.region, "'. \n          Available nodes are ").concat(Object.keys(countryNodes.data.data.regionalMap).join(', '), "."));
            case 16:
              instance.defaults.baseURL = regionDefinition.lslApi;
              return _context.abrupt("return", login());
            case 18:
              jwtToken = loginResponse.data.data.authTicket.token;
              accountId = loginResponse.data.data.user.id;
              return _context.abrupt("return", loginResponse.data);
            case 21:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));
    return function login() {
      return _ref2.apply(this, arguments);
    };
  }();
  var loginWrapper = function loginWrapper(func) {
    return /*#__PURE__*/(0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee2() {
      return _regenerator["default"].wrap(function _callee2$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              _context2.prev = 0;
              if (jwtToken) {
                _context2.next = 4;
                break;
              }
              _context2.next = 4;
              return login();
            case 4:
              return _context2.abrupt("return", func());
            case 7:
              _context2.prev = 7;
              _context2.t0 = _context2["catch"](0);
              _context2.next = 11;
              return login();
            case 11:
              return _context2.abrupt("return", func());
            case 12:
            case "end":
              return _context2.stop();
          }
        }
      }, _callee2, null, [[0, 7]]);
    }));
  };
  var getConnections = loginWrapper(/*#__PURE__*/(0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee3() {
    var response;
    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            _context3.next = 2;
            return instance.get(urlMap.connections);
          case 2:
            response = _context3.sent;
            return _context3.abrupt("return", response.data);
          case 4:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  })));
  var getConnection = function getConnection(connections) {
    if (typeof connectionIdentifier === 'string') {
      var match = connections.find(function (_ref5) {
        var firstName = _ref5.firstName,
          lastName = _ref5.lastName;
        return "".concat(firstName, " ").concat(lastName).toLowerCase() === connectionIdentifier.toLowerCase();
      });
      if (!match) {
        throw new Error("Unable to identify connection by given name '".concat(connectionIdentifier, "'."));
      }
      return match.patientId;
    }
    if (typeof connectionIdentifier === 'function') {
      var _match = connectionIdentifier.call(null, connections);
      if (!_match) {
        throw new Error("Unable to identify connection by given name function");
      }
      return _match;
    }
    return connections[0].patientId;
  };
  var readRaw = loginWrapper(/*#__PURE__*/(0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee4() {
    var connections, response;
    return _regenerator["default"].wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            if (connectionId) {
              _context4.next = 7;
              break;
            }
            _context4.next = 3;
            return getConnections();
          case 3:
            connections = _context4.sent;
            if (!(connections.data.length === 0)) {
              _context4.next = 6;
              break;
            }
            throw new Error('Your account does not follow any patients. Pleas start following and try again.');
          case 6:
            connectionId = getConnection(connections.data);
          case 7:
            _context4.next = 9;
            return instance.get("".concat(urlMap.connections, "/").concat(connectionId, "/graph"));
          case 9:
            response = _context4.sent;
            return _context4.abrupt("return", response.data.data);
          case 11:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4);
  })));
  var read = /*#__PURE__*/function () {
    var _ref7 = (0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee5() {
      var response;
      return _regenerator["default"].wrap(function _callee5$(_context5) {
        while (1) {
          switch (_context5.prev = _context5.next) {
            case 0:
              _context5.next = 2;
              return readRaw();
            case 2:
              response = _context5.sent;
              return _context5.abrupt("return", {
                current: (0, _utils.mapData)(response.connection.glucoseMeasurement),
                history: response.graphData.map(_utils.mapData)
              });
            case 4:
            case "end":
              return _context5.stop();
          }
        }
      }, _callee5);
    }));
    return function read() {
      return _ref7.apply(this, arguments);
    };
  }();
  var observe = /*#__PURE__*/function () {
    var _ref8 = (0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee6() {
      return _regenerator["default"].wrap(function _callee6$(_context6) {
        while (1) {
          switch (_context6.prev = _context6.next) {
            case 0:
            case "end":
              return _context6.stop();
          }
        }
      }, _callee6);
    }));
    return function observe() {
      return _ref8.apply(this, arguments);
    };
  }();
  var averageInterval;
  var readAveraged = /*#__PURE__*/function () {
    var _ref9 = (0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee8(amount, callback) {
      var interval,
        mem,
        _args8 = arguments;
      return _regenerator["default"].wrap(function _callee8$(_context8) {
        while (1) {
          switch (_context8.prev = _context8.next) {
            case 0:
              interval = _args8.length > 2 && _args8[2] !== undefined ? _args8[2] : 15000;
              mem = new Map();
              averageInterval = setInterval(/*#__PURE__*/(0, _asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee7() {
                var _yield$read, current, history, memValues, averageValue, averageTrend;
                return _regenerator["default"].wrap(function _callee7$(_context7) {
                  while (1) {
                    switch (_context7.prev = _context7.next) {
                      case 0:
                        _context7.next = 2;
                        return read();
                      case 2:
                        _yield$read = _context7.sent;
                        current = _yield$read.current;
                        history = _yield$read.history;
                        mem.set(current.date.toString(), current);
                        if (mem.size === amount) {
                          memValues = Array.from(mem.values());
                          averageValue = Math.round(memValues.reduce(function (acc, cur) {
                            return acc + cur.value;
                          }, 0) / amount);
                          averageTrend = _utils.trendMap[parseInt((Math.round(memValues.reduce(function (acc, cur) {
                            return acc + _utils.trendMap.indexOf(cur.trend);
                          }, 0) / amount * 100) / 100).toFixed(0), 10)];
                          mem = new Map();
                          callback.apply(null, [{
                            trend: averageTrend,
                            value: averageValue,
                            date: current.date,
                            isHigh: current.isHigh,
                            isLow: current.isLow
                          }, memValues, history]);
                        }
                      case 7:
                      case "end":
                        return _context7.stop();
                    }
                  }
                }, _callee7);
              })), interval);
              return _context8.abrupt("return", function () {
                return clearInterval(averageInterval);
              });
            case 4:
            case "end":
              return _context8.stop();
          }
        }
      }, _callee8);
    }));
    return function readAveraged(_x, _x2) {
      return _ref9.apply(this, arguments);
    };
  }();
  return {
    observe: observe,
    readRaw: readRaw,
    read: read,
    readAveraged: readAveraged,
    login: login
  };
};
exports.LibreLinkUpClient = LibreLinkUpClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXhpb3MiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9qc1NoYSIsIl91dGlscyIsIkxJQlJFX0xJTktfU0VSVkVSIiwidXJsTWFwIiwibG9naW4iLCJjb25uZWN0aW9ucyIsImNvdW50cmllcyIsIkxpYnJlTGlua1VwQ2xpZW50IiwiX3JlZiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJjbGllbnRWZXJzaW9uIiwiY29ubmVjdGlvbklkZW50aWZpZXIiLCJqd3RUb2tlbiIsImFjY291bnRJZCIsImNvbm5lY3Rpb25JZCIsImluc3RhbmNlIiwiYXhpb3MiLCJjcmVhdGUiLCJiYXNlVVJMIiwiaGVhZGVycyIsImNvbm5lY3Rpb24iLCJwcm9kdWN0IiwidmVyc2lvbiIsImludGVyY2VwdG9ycyIsInJlcXVlc3QiLCJ1c2UiLCJjb25maWciLCJhdXRob3JpemF0aW9uIiwiY29uY2F0Iiwic2hhMjU2IiwiZSIsInN5bmNocm9ub3VzIiwiX3JlZjIiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfcmVnZW5lcmF0b3IiLCJtYXJrIiwiX2NhbGxlZSIsImxvZ2luUmVzcG9uc2UiLCJfc3RlcCIsInJlZGlyZWN0UmVzcG9uc2UiLCJjb3VudHJ5Tm9kZXMiLCJ0YXJnZXRSZWdpb24iLCJyZWdpb25EZWZpbml0aW9uIiwid3JhcCIsIl9jYWxsZWUkIiwiX2NvbnRleHQiLCJwcmV2IiwibmV4dCIsInBvc3QiLCJlbWFpbCIsInNlbnQiLCJkYXRhIiwic3RhdHVzIiwiRXJyb3IiLCJzdGVwIiwiY29tcG9uZW50TmFtZSIsInJlZGlyZWN0IiwiZ2V0IiwicmVnaW9uIiwicmVnaW9uYWxNYXAiLCJPYmplY3QiLCJrZXlzIiwiam9pbiIsImRlZmF1bHRzIiwibHNsQXBpIiwiYWJydXB0IiwiYXV0aFRpY2tldCIsInRva2VuIiwidXNlciIsImlkIiwic3RvcCIsImFwcGx5IiwiYXJndW1lbnRzIiwibG9naW5XcmFwcGVyIiwiZnVuYyIsIl9jYWxsZWUyIiwiX2NhbGxlZTIkIiwiX2NvbnRleHQyIiwidDAiLCJnZXRDb25uZWN0aW9ucyIsIl9jYWxsZWUzIiwicmVzcG9uc2UiLCJfY2FsbGVlMyQiLCJfY29udGV4dDMiLCJnZXRDb25uZWN0aW9uIiwibWF0Y2giLCJmaW5kIiwiX3JlZjUiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInRvTG93ZXJDYXNlIiwicGF0aWVudElkIiwiY2FsbCIsInJlYWRSYXciLCJfY2FsbGVlNCIsIl9jYWxsZWU0JCIsIl9jb250ZXh0NCIsImxlbmd0aCIsInJlYWQiLCJfcmVmNyIsIl9jYWxsZWU1IiwiX2NhbGxlZTUkIiwiX2NvbnRleHQ1IiwiY3VycmVudCIsIm1hcERhdGEiLCJnbHVjb3NlTWVhc3VyZW1lbnQiLCJoaXN0b3J5IiwiZ3JhcGhEYXRhIiwibWFwIiwib2JzZXJ2ZSIsIl9yZWY4IiwiX2NhbGxlZTYiLCJfY2FsbGVlNiQiLCJfY29udGV4dDYiLCJhdmVyYWdlSW50ZXJ2YWwiLCJyZWFkQXZlcmFnZWQiLCJfcmVmOSIsIl9jYWxsZWU4IiwiYW1vdW50IiwiY2FsbGJhY2siLCJpbnRlcnZhbCIsIm1lbSIsIl9hcmdzOCIsIl9jYWxsZWU4JCIsIl9jb250ZXh0OCIsInVuZGVmaW5lZCIsIk1hcCIsInNldEludGVydmFsIiwiX2NhbGxlZTciLCJfeWllbGQkcmVhZCIsIm1lbVZhbHVlcyIsImF2ZXJhZ2VWYWx1ZSIsImF2ZXJhZ2VUcmVuZCIsIl9jYWxsZWU3JCIsIl9jb250ZXh0NyIsInNldCIsImRhdGUiLCJ0b1N0cmluZyIsInNpemUiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJNYXRoIiwicm91bmQiLCJyZWR1Y2UiLCJhY2MiLCJjdXIiLCJ2YWx1ZSIsInRyZW5kTWFwIiwicGFyc2VJbnQiLCJpbmRleE9mIiwidHJlbmQiLCJ0b0ZpeGVkIiwiaXNIaWdoIiwiaXNMb3ciLCJjbGVhckludGVydmFsIiwiX3giLCJfeDIiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vc3JjL2NsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHsgc2hhMjU2IH0gZnJvbSAnanMtc2hhMjU2JztcbmltcG9ydCB7IExpYnJlQ2dtRGF0YSB9IGZyb20gJy4vdHlwZXMvY2xpZW50JztcbmltcG9ydCB7IEFjdGl2ZVNlbnNvciwgQ29ubmVjdGlvbiwgR2x1Y29zZUl0ZW0gfSBmcm9tICcuL3R5cGVzL2Nvbm5lY3Rpb24nO1xuaW1wb3J0IHsgQ29ubmVjdGlvbnNSZXNwb25zZSwgRGF0dW0gfSBmcm9tICcuL3R5cGVzL2Nvbm5lY3Rpb25zJztcbmltcG9ydCB7IENvdW50cnlSZXNwb25zZSwgQUUsIFJlZ2lvbmFsTWFwIH0gZnJvbSAnLi90eXBlcy9jb3VudHJpZXMnO1xuaW1wb3J0IHsgR3JhcGhEYXRhIH0gZnJvbSAnLi90eXBlcy9ncmFwaCc7XG5pbXBvcnQgeyBMb2dpblJlc3BvbnNlLCBMb2dpblJlZGlyZWN0UmVzcG9uc2UsIFN0ZXBEYXRhIH0gZnJvbSAnLi90eXBlcy9sb2dpbic7XG5pbXBvcnQgeyBtYXBEYXRhLCB0cmVuZE1hcCB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBMSUJSRV9MSU5LX1NFUlZFUiA9ICdodHRwczovL2FwaS11cy5saWJyZXZpZXcuaW8nO1xuXG50eXBlIENsaWVudEFyZ3MgPSB7XG4gIHVzZXJuYW1lOiBzdHJpbmc7XG4gIHBhc3N3b3JkOiBzdHJpbmc7XG4gIGNsaWVudFZlcnNpb24/OiBzdHJpbmc7XG4gIGNvbm5lY3Rpb25JZGVudGlmaWVyPzogc3RyaW5nIHwgKChjb25uZWN0aW9uczogRGF0dW1bXSkgPT4gc3RyaW5nKTtcbn07XG5cbnR5cGUgUmVhZFJhd1Jlc3BvbnNlID0ge1xuICBjb25uZWN0aW9uOiBDb25uZWN0aW9uO1xuICBhY3RpdmVTZW5zb3JzOiBBY3RpdmVTZW5zb3JbXTtcbiAgZ3JhcGhEYXRhOiBHbHVjb3NlSXRlbVtdO1xufTtcblxudHlwZSBSZWFkUmVzcG9uc2UgPSB7XG4gIGN1cnJlbnQ6IExpYnJlQ2dtRGF0YTtcbiAgaGlzdG9yeTogTGlicmVDZ21EYXRhW107XG59O1xuXG5jb25zdCB1cmxNYXAgPSB7XG4gIGxvZ2luOiAnL2xsdS9hdXRoL2xvZ2luJyxcbiAgY29ubmVjdGlvbnM6ICcvbGx1L2Nvbm5lY3Rpb25zJyxcbiAgY291bnRyaWVzOiAnL2xsdS9jb25maWcvY291bnRyeT9jb3VudHJ5PURFJyxcbn07XG5cbmV4cG9ydCBjb25zdCBMaWJyZUxpbmtVcENsaWVudCA9ICh7XG4gIHVzZXJuYW1lLFxuICBwYXNzd29yZCxcbiAgY2xpZW50VmVyc2lvbixcbiAgY29ubmVjdGlvbklkZW50aWZpZXIsXG59OiBDbGllbnRBcmdzKSA9PiB7XG4gIGxldCBqd3RUb2tlbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBhY2NvdW50SWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgY29ubmVjdGlvbklkOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICBjb25zdCBpbnN0YW5jZSA9IGF4aW9zLmNyZWF0ZSh7XG4gICAgYmFzZVVSTDogTElCUkVfTElOS19TRVJWRVIsXG4gICAgaGVhZGVyczoge1xuICAgICAgJ2FjY2VwdC1lbmNvZGluZyc6ICdnemlwJyxcbiAgICAgICdjYWNoZS1jb250cm9sJzogJ25vLWNhY2hlJyxcbiAgICAgIGNvbm5lY3Rpb246ICdLZWVwLUFsaXZlJyxcbiAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICBwcm9kdWN0OiAnbGx1LmFuZHJvaWQnLFxuICAgICAgdmVyc2lvbjogY2xpZW50VmVyc2lvbiA/PyAnNC4xMi4wJyxcbiAgICAgICdhY2NvdW50LWlkJzogJycsXG4gICAgfSxcbiAgfSk7XG4gIGluc3RhbmNlLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShcbiAgICBjb25maWcgPT4ge1xuICAgICAgaWYgKGp3dFRva2VuICYmIGNvbmZpZy5oZWFkZXJzICYmIGFjY291bnRJZCkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICAgICAgY29uZmlnLmhlYWRlcnMuYXV0aG9yaXphdGlvbiA9IGBCZWFyZXIgJHtqd3RUb2tlbn1gO1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICAgICAgY29uZmlnLmhlYWRlcnNbJ2FjY291bnQtaWQnXSA9IHNoYTI1NihhY2NvdW50SWQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gY29uZmlnO1xuICAgIH0sXG4gICAgZSA9PiBlLFxuICAgIHsgc3luY2hyb25vdXM6IHRydWUgfVxuICApO1xuXG4gIGNvbnN0IGxvZ2luID0gYXN5bmMgKCk6IFByb21pc2U8TG9naW5SZXNwb25zZT4gPT4ge1xuICAgIGNvbnN0IGxvZ2luUmVzcG9uc2UgPSBhd2FpdCBpbnN0YW5jZS5wb3N0PFxuICAgICAgTG9naW5SZXNwb25zZSB8IExvZ2luUmVkaXJlY3RSZXNwb25zZVxuICAgID4odXJsTWFwLmxvZ2luLCB7XG4gICAgICBlbWFpbDogdXNlcm5hbWUsXG4gICAgICBwYXNzd29yZCxcbiAgICB9KTtcblxuICAgIGlmIChsb2dpblJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdCYWQgY3JlZGVudGlhbHMuIFBsZWFzZSBlbnN1cmUgdGhhdCB5b3UgaGF2ZSBlbnRlcmVkIHRoZSBjcmVkZW50aWFscyBvZiB5b3VyIExpYnJlTGlua1VwIGFjY291bnQgKGFuZCBub3Qgb2YgeW91ciBMaWJyZUxpbmsgYWNjb3VudCkuJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAobG9naW5SZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gNCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQWRkaXRpb25hbCBhY3Rpb24gcmVxdWlyZWQgZm9yIHlvdXIgYWNjb3VudDogJHtcbiAgICAgICAgICAobG9naW5SZXNwb25zZS5kYXRhLmRhdGEgYXMgU3RlcERhdGEpLnN0ZXA/LmNvbXBvbmVudE5hbWUgfHwgJ3Vua25vd24nXG4gICAgICAgIH0uIFBsZWFzZSBsb2dpbiB2aWEgYXBwIGFuZCBwZXJmb3JtIHJlcXVpcmVkIHN0ZXBzIGFuZCB0cnkgYWdhaW4uYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoKGxvZ2luUmVzcG9uc2UuZGF0YSBhcyBMb2dpblJlZGlyZWN0UmVzcG9uc2UpLmRhdGEucmVkaXJlY3QpIHtcbiAgICAgIGNvbnN0IHJlZGlyZWN0UmVzcG9uc2UgPSBsb2dpblJlc3BvbnNlLmRhdGEgYXMgTG9naW5SZWRpcmVjdFJlc3BvbnNlO1xuICAgICAgY29uc3QgY291bnRyeU5vZGVzID0gYXdhaXQgaW5zdGFuY2UuZ2V0PENvdW50cnlSZXNwb25zZT4oXG4gICAgICAgIHVybE1hcC5jb3VudHJpZXNcbiAgICAgICk7XG4gICAgICBjb25zdCB0YXJnZXRSZWdpb24gPSByZWRpcmVjdFJlc3BvbnNlLmRhdGEucmVnaW9uIGFzIGtleW9mIFJlZ2lvbmFsTWFwO1xuICAgICAgY29uc3QgcmVnaW9uRGVmaW5pdGlvbjogQUUgfCB1bmRlZmluZWQgPVxuICAgICAgICBjb3VudHJ5Tm9kZXMuZGF0YS5kYXRhLnJlZ2lvbmFsTWFwW3RhcmdldFJlZ2lvbl07XG5cbiAgICAgIGlmICghcmVnaW9uRGVmaW5pdGlvbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYFVuYWJsZSB0byBmaW5kIHJlZ2lvbiAnJHtyZWRpcmVjdFJlc3BvbnNlLmRhdGEucmVnaW9ufScuIFxuICAgICAgICAgIEF2YWlsYWJsZSBub2RlcyBhcmUgJHtPYmplY3Qua2V5cyhcbiAgICAgICAgICAgIGNvdW50cnlOb2Rlcy5kYXRhLmRhdGEucmVnaW9uYWxNYXBcbiAgICAgICAgICApLmpvaW4oJywgJyl9LmBcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaW5zdGFuY2UuZGVmYXVsdHMuYmFzZVVSTCA9IHJlZ2lvbkRlZmluaXRpb24ubHNsQXBpO1xuICAgICAgcmV0dXJuIGxvZ2luKCk7XG4gICAgfVxuICAgIGp3dFRva2VuID0gKGxvZ2luUmVzcG9uc2UuZGF0YSBhcyBMb2dpblJlc3BvbnNlKS5kYXRhLmF1dGhUaWNrZXQudG9rZW47XG4gICAgYWNjb3VudElkID0gKGxvZ2luUmVzcG9uc2UuZGF0YSBhcyBMb2dpblJlc3BvbnNlKS5kYXRhLnVzZXIuaWQ7XG5cbiAgICByZXR1cm4gbG9naW5SZXNwb25zZS5kYXRhIGFzIExvZ2luUmVzcG9uc2U7XG4gIH07XG5cbiAgY29uc3QgbG9naW5XcmFwcGVyID1cbiAgICA8UmV0dXJuPihmdW5jOiAoKSA9PiBQcm9taXNlPFJldHVybj4pID0+XG4gICAgYXN5bmMgKCk6IFByb21pc2U8UmV0dXJuPiA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIWp3dFRva2VuKSBhd2FpdCBsb2dpbigpO1xuICAgICAgICByZXR1cm4gZnVuYygpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBhd2FpdCBsb2dpbigpO1xuICAgICAgICByZXR1cm4gZnVuYygpO1xuICAgICAgfVxuICAgIH07XG5cbiAgY29uc3QgZ2V0Q29ubmVjdGlvbnMgPSBsb2dpbldyYXBwZXI8Q29ubmVjdGlvbnNSZXNwb25zZT4oYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW5zdGFuY2UuZ2V0PENvbm5lY3Rpb25zUmVzcG9uc2U+KFxuICAgICAgdXJsTWFwLmNvbm5lY3Rpb25zXG4gICAgKTtcblxuICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICB9KTtcblxuICBjb25zdCBnZXRDb25uZWN0aW9uID0gKGNvbm5lY3Rpb25zOiBEYXR1bVtdKTogc3RyaW5nID0+IHtcbiAgICBpZiAodHlwZW9mIGNvbm5lY3Rpb25JZGVudGlmaWVyID09PSAnc3RyaW5nJykge1xuICAgICAgY29uc3QgbWF0Y2ggPSBjb25uZWN0aW9ucy5maW5kKFxuICAgICAgICAoeyBmaXJzdE5hbWUsIGxhc3ROYW1lIH0pID0+XG4gICAgICAgICAgYCR7Zmlyc3ROYW1lfSAke2xhc3ROYW1lfWAudG9Mb3dlckNhc2UoKSA9PT1cbiAgICAgICAgICBjb25uZWN0aW9uSWRlbnRpZmllci50b0xvd2VyQ2FzZSgpXG4gICAgICApO1xuXG4gICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgVW5hYmxlIHRvIGlkZW50aWZ5IGNvbm5lY3Rpb24gYnkgZ2l2ZW4gbmFtZSAnJHtjb25uZWN0aW9uSWRlbnRpZmllcn0nLmBcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1hdGNoLnBhdGllbnRJZDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjb25uZWN0aW9uSWRlbnRpZmllciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29uc3QgbWF0Y2ggPSBjb25uZWN0aW9uSWRlbnRpZmllci5jYWxsKG51bGwsIGNvbm5lY3Rpb25zKTtcblxuICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBpZGVudGlmeSBjb25uZWN0aW9uIGJ5IGdpdmVuIG5hbWUgZnVuY3Rpb25gKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1hdGNoO1xuICAgIH1cblxuICAgIHJldHVybiBjb25uZWN0aW9uc1swXS5wYXRpZW50SWQ7XG4gIH07XG5cbiAgY29uc3QgcmVhZFJhdyA9IGxvZ2luV3JhcHBlcjxSZWFkUmF3UmVzcG9uc2U+KGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWNvbm5lY3Rpb25JZCkge1xuICAgICAgY29uc3QgY29ubmVjdGlvbnMgPSBhd2FpdCBnZXRDb25uZWN0aW9ucygpO1xuXG4gICAgICBpZiAoY29ubmVjdGlvbnMuZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdZb3VyIGFjY291bnQgZG9lcyBub3QgZm9sbG93IGFueSBwYXRpZW50cy4gUGxlYXMgc3RhcnQgZm9sbG93aW5nIGFuZCB0cnkgYWdhaW4uJ1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25uZWN0aW9uSWQgPSBnZXRDb25uZWN0aW9uKGNvbm5lY3Rpb25zLmRhdGEpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW5zdGFuY2UuZ2V0PEdyYXBoRGF0YT4oXG4gICAgICBgJHt1cmxNYXAuY29ubmVjdGlvbnN9LyR7Y29ubmVjdGlvbklkfS9ncmFwaGBcbiAgICApO1xuXG4gICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuZGF0YTtcbiAgfSk7XG5cbiAgY29uc3QgcmVhZCA9IGFzeW5jICgpOiBQcm9taXNlPFJlYWRSZXNwb25zZT4gPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVhZFJhdygpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGN1cnJlbnQ6IG1hcERhdGEocmVzcG9uc2UuY29ubmVjdGlvbi5nbHVjb3NlTWVhc3VyZW1lbnQpLFxuICAgICAgaGlzdG9yeTogcmVzcG9uc2UuZ3JhcGhEYXRhLm1hcChtYXBEYXRhKSxcbiAgICB9O1xuICB9O1xuXG4gIGNvbnN0IG9ic2VydmUgPSBhc3luYyAoKSA9PiB7XG4gICAgLy8gQHRvZG9cbiAgfTtcblxuICBsZXQgYXZlcmFnZUludGVydmFsOiBOb2RlSlMuVGltZXI7XG4gIGNvbnN0IHJlYWRBdmVyYWdlZCA9IGFzeW5jIChcbiAgICBhbW91bnQ6IG51bWJlcixcbiAgICBjYWxsYmFjazogKFxuICAgICAgYXZlcmFnZTogTGlicmVDZ21EYXRhLFxuICAgICAgbWVtb3J5OiBMaWJyZUNnbURhdGFbXSxcbiAgICAgIGhpc3Rvcnk6IExpYnJlQ2dtRGF0YVtdXG4gICAgKSA9PiB2b2lkLFxuICAgIGludGVydmFsID0gMTUwMDBcbiAgKSA9PiB7XG4gICAgbGV0IG1lbTogTWFwPHN0cmluZywgTGlicmVDZ21EYXRhPiA9IG5ldyBNYXAoKTtcblxuICAgIGF2ZXJhZ2VJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgY3VycmVudCwgaGlzdG9yeSB9ID0gYXdhaXQgcmVhZCgpO1xuICAgICAgbWVtLnNldChjdXJyZW50LmRhdGUudG9TdHJpbmcoKSwgY3VycmVudCk7XG5cbiAgICAgIGlmIChtZW0uc2l6ZSA9PT0gYW1vdW50KSB7XG4gICAgICAgIGNvbnN0IG1lbVZhbHVlcyA9IEFycmF5LmZyb20obWVtLnZhbHVlcygpKTtcbiAgICAgICAgY29uc3QgYXZlcmFnZVZhbHVlID0gTWF0aC5yb3VuZChcbiAgICAgICAgICBtZW1WYWx1ZXMucmVkdWNlKChhY2MsIGN1cikgPT4gYWNjICsgY3VyLnZhbHVlLCAwKSAvIGFtb3VudFxuICAgICAgICApO1xuICAgICAgICBjb25zdCBhdmVyYWdlVHJlbmQgPVxuICAgICAgICAgIHRyZW5kTWFwW1xuICAgICAgICAgICAgcGFyc2VJbnQoXG4gICAgICAgICAgICAgIChcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKFxuICAgICAgICAgICAgICAgICAgKG1lbVZhbHVlcy5yZWR1Y2UoXG4gICAgICAgICAgICAgICAgICAgIChhY2MsIGN1cikgPT4gYWNjICsgdHJlbmRNYXAuaW5kZXhPZihjdXIudHJlbmQpLFxuICAgICAgICAgICAgICAgICAgICAwXG4gICAgICAgICAgICAgICAgICApIC9cbiAgICAgICAgICAgICAgICAgICAgYW1vdW50KSAqXG4gICAgICAgICAgICAgICAgICAgIDEwMFxuICAgICAgICAgICAgICAgICkgLyAxMDBcbiAgICAgICAgICAgICAgKS50b0ZpeGVkKDApLFxuICAgICAgICAgICAgICAxMFxuICAgICAgICAgICAgKVxuICAgICAgICAgIF07XG5cbiAgICAgICAgbWVtID0gbmV3IE1hcCgpO1xuICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHJlbmQ6IGF2ZXJhZ2VUcmVuZCxcbiAgICAgICAgICAgIHZhbHVlOiBhdmVyYWdlVmFsdWUsXG4gICAgICAgICAgICBkYXRlOiBjdXJyZW50LmRhdGUsXG4gICAgICAgICAgICBpc0hpZ2g6IGN1cnJlbnQuaXNIaWdoLFxuICAgICAgICAgICAgaXNMb3c6IGN1cnJlbnQuaXNMb3csXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtZW1WYWx1ZXMsXG4gICAgICAgICAgaGlzdG9yeSxcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgfSwgaW50ZXJ2YWwpO1xuXG4gICAgcmV0dXJuICgpID0+IGNsZWFySW50ZXJ2YWwoYXZlcmFnZUludGVydmFsKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIG9ic2VydmUsXG4gICAgcmVhZFJhdyxcbiAgICByZWFkLFxuICAgIHJlYWRBdmVyYWdlZCxcbiAgICBsb2dpbixcbiAgfTtcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLE1BQUEsR0FBQUQsT0FBQTtBQU9BLElBQUFFLE1BQUEsR0FBQUYsT0FBQTtBQUVBLElBQU1HLGlCQUFpQixHQUFHLDZCQUE2QjtBQW9CdkQsSUFBTUMsTUFBTSxHQUFHO0VBQ2JDLEtBQUssRUFBRSxpQkFBaUI7RUFDeEJDLFdBQVcsRUFBRSxrQkFBa0I7RUFDL0JDLFNBQVMsRUFBRTtBQUNiLENBQUM7QUFFTSxJQUFNQyxpQkFBaUIsR0FBRyxTQUFwQkEsaUJBQWlCQSxDQUFBQyxJQUFBLEVBS1o7RUFBQSxJQUpoQkMsUUFBUSxHQUFBRCxJQUFBLENBQVJDLFFBQVE7SUFDUkMsUUFBUSxHQUFBRixJQUFBLENBQVJFLFFBQVE7SUFDUkMsYUFBYSxHQUFBSCxJQUFBLENBQWJHLGFBQWE7SUFDYkMsb0JBQW9CLEdBQUFKLElBQUEsQ0FBcEJJLG9CQUFvQjtFQUVwQixJQUFJQyxRQUF1QixHQUFHLElBQUk7RUFDbEMsSUFBSUMsU0FBd0IsR0FBRyxJQUFJO0VBQ25DLElBQUlDLFlB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